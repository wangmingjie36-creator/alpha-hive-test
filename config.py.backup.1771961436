"""
ğŸ Alpha Hive - é…ç½®ç®¡ç†
å­˜å‚¨ API å¯†é’¥ã€æ•°æ®æºé…ç½®ã€ç¼“å­˜ç­–ç•¥
"""

import os
from datetime import datetime

# ==================== API é…ç½® ====================
API_KEYS = {
    # Polymarket APIï¼ˆæ— éœ€è®¤è¯ï¼Œå…¬å¼€æ•°æ®ï¼‰
    "POLYMARKET": {
        "base_url": "https://clob.polymarket.com",
        "endpoints": {
            "markets": "/markets",
            "prices": "/prices",
        }
    },

    # StockTwits API
    "STOCKTWITS": {
        "base_url": "https://api.stocktwits.com/api/2",
        "endpoints": {
            "streams": "/streams/symbols/{symbol}.json",
        }
    },

    # Yahoo Financeï¼ˆé€šè¿‡ yfinance åº“ï¼‰
    "YAHOO_FINANCE": {
        "use_library": True,  # ä½¿ç”¨ yfinance åº“è€Œä¸æ˜¯ç›´æ¥ API
    },

    # Google Trendsï¼ˆé€šè¿‡ pytrends åº“ï¼‰
    "GOOGLE_TRENDS": {
        "use_library": True,  # ä½¿ç”¨ pytrends åº“
    },

    # SEC EDGAR
    "SEC_EDGAR": {
        "base_url": "https://www.sec.gov/cgi-bin",
        "headers": {
            "User-Agent": "Mozilla/5.0 (compatible; AlphaHive/1.0)"
        }
    },

    # Yahoo Financeï¼ˆæœŸæƒæ•°æ®é€šè¿‡ yfinance åº“è·å–ï¼‰
    "YAHOO_FINANCE_OPTIONS": {
        "enabled": True,
        "description": "ä½¿ç”¨ yfinance åº“è·å–æœŸæƒæ•°æ®ï¼ˆå…è´¹ã€æ— éœ€ API Tokenï¼‰"
    },
}

# ==================== ç¼“å­˜é…ç½® ====================
CACHE_CONFIG = {
    "enabled": True,
    "cache_dir": "/Users/igg/.claude/reports/cache",
    "ttl": {  # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
        "stocktwits": 3600,  # 1 å°æ—¶
        "polymarket": 300,   # 5 åˆ†é’Ÿï¼ˆé¢‘ç¹å˜åŒ–ï¼‰
        "yahoo_finance": 300,  # 5 åˆ†é’Ÿ
        "google_trends": 86400,  # 24 å°æ—¶
        "seeking_alpha": 86400,  # 24 å°æ—¶
        "sec_edgar": 604800,  # 7 å¤©
    }
}

# ==================== ç›‘æ§æ ‡çš„ ====================
WATCHLIST = {
    # ç§‘æŠ€æ¿å— (Technology) - 5 ä¸ª
    "NVDA": {
        "name": "NVIDIA Corporation",
        "sector": "Technology",
        "polymarket_slug": "nvidia-q1-2026-revenue",
        "monitor_events": ["earnings", "product_launch", "china_sanctions"],
    },
    "TSLA": {
        "name": "Tesla Inc",
        "sector": "Automotive",
        "polymarket_slug": "tesla-delivery-forecast",
        "monitor_events": ["earnings", "production_update", "regulatory"],
    },
    "MSFT": {
        "name": "Microsoft Corporation",
        "sector": "Technology",
        "polymarket_slug": "microsoft-cloud-growth",
        "monitor_events": ["earnings", "azure_adoption", "ai_partnership"],
    },
    "AMD": {
        "name": "Advanced Micro Devices",
        "sector": "Technology",
        "polymarket_slug": "amd-market-share",
        "monitor_events": ["earnings", "product_launch", "supply"],
    },
    "QCOM": {
        "name": "Qualcomm Inc",
        "sector": "Technology",
        "polymarket_slug": "qualcomm-5g-adoption",
        "monitor_events": ["earnings", "flagship_launch"],
    },

    # ç”Ÿç‰©åŒ»è¯ (Healthcare/Biotech) - 5 ä¸ª
    "VKTX": {
        "name": "Viking Therapeutics",
        "sector": "Healthcare",
        "polymarket_slug": "viking-therapeutics-fda-approval",
        "monitor_events": ["trial_results", "fda_decision"],
    },
    "AMGN": {
        "name": "Amgen Inc",
        "sector": "Healthcare",
        "polymarket_slug": "amgen-oncology-pipeline",
        "monitor_events": ["trial_results", "fda_approval"],
    },
    "BIIB": {
        "name": "Biogen Inc",
        "sector": "Healthcare",
        "polymarket_slug": "biogen-alzheimers",
        "monitor_events": ["clinical_trial", "regulatory_approval"],
    },
    "JNJ": {
        "name": "Johnson & Johnson",
        "sector": "Healthcare",
        "polymarket_slug": "jnj-pharma-pipeline",
        "monitor_events": ["earnings", "clinical_trial_results"],
    },
    "REGN": {
        "name": "Regeneron Pharmaceuticals",
        "sector": "Healthcare",
        "polymarket_slug": "regn-obesity-drug",
        "monitor_events": ["clinical_data", "fda_decision"],
    },

    # æ¸…æ´èƒ½æº (Clean Energy) - 5 ä¸ª
    "PLUG": {
        "name": "Plug Power Inc",
        "sector": "CleanEnergy",
        "polymarket_slug": "plug-hydrogen-adoption",
        "monitor_events": ["supply_deal", "partnership_announcement"],
    },
    "RUN": {
        "name": "Sunrun Inc",
        "sector": "CleanEnergy",
        "polymarket_slug": "sunrun-irs-credits",
        "monitor_events": ["policy_change", "installation_growth"],
    },
    "NEE": {
        "name": "NextEra Energy",
        "sector": "CleanEnergy",
        "polymarket_slug": "nextEra-renewable-expansion",
        "monitor_events": ["earnings", "capacity_expansion"],
    },
    "ICLN": {
        "name": "iClean Energy ETF",
        "sector": "CleanEnergy",
        "polymarket_slug": "clean-energy-policy",
        "monitor_events": ["legislation", "irs_guidance"],
    },
    "ENPH": {
        "name": "Enphase Energy",
        "sector": "CleanEnergy",
        "polymarket_slug": "enphase-battery-sales",
        "monitor_events": ["earnings", "product_launch"],
    },

    # é‡‘èç§‘æŠ€ (FinTech) - 3 ä¸ª
    "SQ": {
        "name": "Block Inc",
        "sector": "FinTech",
        "polymarket_slug": "square-btc-adoption",
        "monitor_events": ["earnings", "product_launch"],
    },
    "COIN": {
        "name": "Coinbase Global",
        "sector": "FinTech",
        "polymarket_slug": "coinbase-btc-price",
        "monitor_events": ["earnings", "regulatory_approval"],
    },
    "MSTR": {
        "name": "MicroStrategy Inc",
        "sector": "FinTech",
        "polymarket_slug": "mstr-bitcoin-reserve",
        "monitor_events": ["btc_purchase", "quarterly_earnings"],
    },

    # äººå·¥æ™ºèƒ½ (AI) - 2 ä¸ª
    "UPST": {
        "name": "Upstart Holdings",
        "sector": "AI",
        "polymarket_slug": "upstart-ai-lending",
        "monitor_events": ["earnings", "partnership"],
    },
}

# ==================== æ•°æ®æºä¼˜å…ˆçº§ ====================
DATA_SOURCE_PRIORITY = {
    "stocktwits_messages": 1,  # å¯é æ€§æœ€é«˜
    "polymarket_odds": 2,
    "sec_filings": 2,
    "google_trends": 3,
    "seeking_alpha": 3,
    "twitter_sentiment": 4,
}

# ==================== è¿è¡Œé…ç½® ====================
RUNTIME_CONFIG = {
    "debug": True,
    "log_file": "/Users/igg/.claude/reports/logs/data_fetcher.log",
    "max_retries": 3,
    "timeout": 10,  # è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
    "rate_limit_delay": 1,  # è¯·æ±‚é—´å»¶è¿Ÿï¼ˆç§’ï¼‰
}

# ==================== å‚¬åŒ–å‰‚æ—¥æœŸ ====================
CATALYSTS = {
    # ç§‘æŠ€
    "NVDA": [
        {
            "event": "Q4 FY2026 Earnings",
            "scheduled_date": "2026-03-15",
            "scheduled_time": "16:00",
            "time_zone": "US/Eastern",
        },
        {
            "event": "Computex 2026",
            "scheduled_date": "2026-05-28",
            "scheduled_time": "09:00",
            "time_zone": "Asia/Taipei",
        },
    ],
    "MSFT": [
        {
            "event": "Q3 FY2026 Earnings",
            "scheduled_date": "2026-04-23",
            "scheduled_time": "16:30",
            "time_zone": "US/Eastern",
        },
    ],
    "AMD": [
        {
            "event": "Q1 2026 Earnings",
            "scheduled_date": "2026-05-07",
            "scheduled_time": "17:00",
            "time_zone": "US/Eastern",
        },
    ],
    "QCOM": [
        {
            "event": "Q2 FY2026 Earnings",
            "scheduled_date": "2026-04-29",
            "scheduled_time": "16:45",
            "time_zone": "US/Eastern",
        },
    ],

    # ç”Ÿç‰©åŒ»è¯
    "VKTX": [
        {
            "event": "Phase 3 Trial Results",
            "scheduled_date": "2026-08-15",
            "scheduled_time": "08:30",
            "time_zone": "US/Eastern",
        },
    ],
    "AMGN": [
        {
            "event": "Q1 2026 Earnings",
            "scheduled_date": "2026-04-28",
            "scheduled_time": "16:30",
            "time_zone": "US/Eastern",
        },
    ],
    "BIIB": [
        {
            "event": "Q1 2026 Earnings",
            "scheduled_date": "2026-05-13",
            "scheduled_time": "16:00",
            "time_zone": "US/Eastern",
        },
    ],
    "JNJ": [
        {
            "event": "Q1 2026 Earnings",
            "scheduled_date": "2026-04-14",
            "scheduled_time": "07:00",
            "time_zone": "US/Eastern",
        },
    ],
    "REGN": [
        {
            "event": "Q1 2026 Earnings",
            "scheduled_date": "2026-05-06",
            "scheduled_time": "08:00",
            "time_zone": "US/Eastern",
        },
    ],

    # æ¸…æ´èƒ½æº
    "PLUG": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-03-10",
            "scheduled_time": "17:00",
            "time_zone": "US/Eastern",
        },
    ],
    "RUN": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-02-24",
            "scheduled_time": "17:00",
            "time_zone": "US/Eastern",
        },
    ],
    "NEE": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-02-25",
            "scheduled_time": "08:00",
            "time_zone": "US/Eastern",
        },
    ],
    "ENPH": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-02-26",
            "scheduled_time": "16:30",
            "time_zone": "US/Eastern",
        },
    ],

    # FinTech
    "SQ": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-03-17",
            "scheduled_time": "17:00",
            "time_zone": "US/Eastern",
        },
    ],
    "COIN": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-03-04",
            "scheduled_time": "17:00",
            "time_zone": "US/Eastern",
        },
    ],
    "MSTR": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-02-26",
            "scheduled_time": "17:00",
            "time_zone": "US/Eastern",
        },
    ],

    # AI
    "UPST": [
        {
            "event": "Q4 2025 Earnings",
            "scheduled_date": "2026-02-24",
            "scheduled_time": "16:30",
            "time_zone": "US/Eastern",
        },
    ],
    "TSLA": [
        {
            "event": "Q1 2026 Earnings",
            "scheduled_date": "2026-04-22",
            "scheduled_time": "16:00",
            "time_zone": "US/Pacific",
        },
    ],
}

# ==================== è¯„åˆ†æƒé‡ï¼ˆ6ç»´è¯„ä¼°ï¼Œå«æœŸæƒä¿¡å·ï¼‰====================
EVALUATION_WEIGHTS = {
    "signal": 0.25,           # -0.05ï¼ˆä¸ºæœŸæƒè…¾å‡ºç©ºé—´ï¼‰
    "catalyst": 0.20,         # ä¸å˜
    "sentiment": 0.15,        # -0.05ï¼ˆä¸ºæœŸæƒè…¾å‡ºç©ºé—´ï¼‰
    "odds": 0.15,             # ä¸å˜
    "risk_adjustment": 0.15,  # ä¸å˜
    "options": 0.10,          # æ–°å¢ï¼šæœŸæƒä¿¡å·ç»´åº¦
}

# ==================== æœŸæƒè¯„åˆ†é˜ˆå€¼ ====================
OPTIONS_SCORE_THRESHOLDS = {
    "iv_rank_neutral_min": 30,      # IV Rank < 30 è§†ä¸ºä½ IV
    "iv_rank_neutral_max": 70,      # IV Rank > 70 è§†ä¸ºé«˜ IV
    "put_call_bullish": 0.7,        # P/C < 0.7 çœ‹å¤šä¿¡å·å¼º
    "put_call_bearish": 1.5,        # P/C > 1.5 çœ‹ç©ºä¿¡å·å¼º
    "unusual_volume_ratio": 5,      # volume/OI > 5 è§†ä¸ºå¼‚åŠ¨
    "options_score_threshold": 6.0, # æœŸæƒç»¼åˆè¯„åˆ† >= 6.0 ä¸ºæ­£ä¿¡å·
}

# ==================== yFinance æœŸæƒæ•°æ®æº ====================
# ä½¿ç”¨ yfinance åº“è·å–æœŸæƒæ•°æ®ï¼ˆå…è´¹ã€æ— éœ€ API Tokenï¼‰
YFINANCE_OPTIONS_CONFIG = {
    "enabled": True,
    "cache_ttl": 300,  # 5 åˆ†é’Ÿç¼“å­˜
    "description": "Yahoo Finance æœŸæƒæ•°æ®ï¼ˆé€šè¿‡ yfinance åº“ï¼‰"
}

# ==================== æ‹¥æŒ¤åº¦æƒé‡ ====================
CROWDING_WEIGHTS = {
    "stocktwits_volume": 0.25,
    "google_trends": 0.15,
    "consensus_strength": 0.25,
    "polymarket_volatility": 0.15,
    "seeking_alpha_views": 0.10,
    "short_squeeze_risk": 0.10,
}

# ==================== å¤±æ•ˆæ¡ä»¶é˜ˆå€¼ ====================
THESIS_BREAK_THRESHOLDS = {
    "revenue_decline_pct": 5,
    "eps_miss_pct": 20,
    "polymarket_probability": 60,
    "crowding_score": 75,
}

# ==================== åˆå§‹åŒ–ç¼“å­˜ç›®å½• ====================
def init_cache():
    """åˆå§‹åŒ–ç¼“å­˜ç›®å½•"""
    cache_dir = CACHE_CONFIG["cache_dir"]
    os.makedirs(cache_dir, exist_ok=True)
    os.makedirs(os.path.dirname(RUNTIME_CONFIG["log_file"]), exist_ok=True)

# ==================== å‘Šè­¦é…ç½® (Phase 2) ====================
ALERT_CONFIG = {
    # Slack é€šçŸ¥é…ç½®
    "slack_enabled": False,  # æ”¹ä¸º True åå¯ç”¨ Slack é€šçŸ¥
    "slack_webhook": None,   # Webhook URL ä» ~/.alpha_hive_slack_webhook æ–‡ä»¶è¯»å–

    # é‚®ä»¶é€šçŸ¥é…ç½®
    "email_enabled": False,  # æ”¹ä¸º True åå¯ç”¨é‚®ä»¶é€šçŸ¥
    "email_config": {
        # "smtp_server": "smtp.gmail.com",
        # "smtp_port": 587,
        # "sender_email": "your-email@gmail.com",
        # "sender_password": "your-app-password",  # ä½¿ç”¨åº”ç”¨å¯†ç 
        # "recipient_emails": ["your-email@gmail.com"],
        # "use_tls": True
    },

    # å‘Šè­¦é˜ˆå€¼
    "performance_baseline_seconds": 5.0,  # æ€§èƒ½åŸºçº¿
    "performance_degradation_threshold": 1.5,  # 150% = é«˜äºåŸºçº¿ 50% è§¦å‘å‘Šè­¦

    # å‘Šè­¦è§„åˆ™
    "alert_rules": {
        "enable_critical_alerts": True,      # P0: ç³»ç»Ÿå¤±è´¥
        "enable_high_alerts": True,          # P1: æ­¥éª¤å¤±è´¥ã€æ€§èƒ½å¼‚å¸¸
        "enable_medium_alerts": True,        # P2: ä½åˆ†æŠ¥å‘Š
        "low_score_threshold": 6.0,          # ä½äºæ­¤åˆ†æ•°è§¦å‘å‘Šè­¦
        "no_report_alert": True,             # æ— æŠ¥å‘Šç”Ÿæˆæ—¶å‘Šè­¦
        "deployment_failure_alert": True,    # GitHub éƒ¨ç½²å¤±è´¥æ—¶å‘Šè­¦
    },

    # å‘Šè­¦è¾“å‡º
    "save_alerts_json": True,  # ä¿å­˜å‘Šè­¦åˆ° JSON æ–‡ä»¶
    "alerts_log_dir": "/Users/igg/.claude/logs",
}

# ==================== æ€§èƒ½ç›‘æ§é…ç½® (Phase 2) ====================
METRICS_CONFIG = {
    "enabled": True,
    "db_path": "/Users/igg/.claude/reports/metrics.db",
    "retention_days": 90,  # ä¿ç•™ 90 å¤©æ•°æ®
    "collect_metrics": {
        "execution_time": True,
        "memory_usage": True,
        "file_sizes": True,
        "report_quality": True,
        "deployment_status": True,
    }
}

# ==================== ä¿¡æ¯ç´ æ¿æŒä¹…åŒ–é…ç½® (Phase 2) ====================
PHEROMONE_CONFIG = {
    "enabled": True,
    "db_path": "/Users/igg/.claude/reports/pheromone.db",
    "retention_days": 30,  # ä¿ç•™ 30 å¤©ä¿¡æ¯ç´ æ•°æ®
    "decay_rate": 0.1,     # æ¯æ—¥è¡°å‡ 10%
    "accuracy_tracking": {
        "enable_t1_tracking": True,      # T+1 å‡†ç¡®ç‡å›çœ‹
        "enable_t7_tracking": True,      # T+7 å‡†ç¡®ç‡å›çœ‹
        "enable_t30_tracking": True,     # T+30 å‡†ç¡®ç‡å›çœ‹
    }
}

# ==================== åŠ¨æ€èœ‚ç¾¤é…ç½® (Phase 2) ====================
SWARM_CONFIG = {
    "enabled": True,
    "adaptive_spawning": {
        "base_agents": 10,
        "min_agents": 8,
        "max_agents": 100,
        "complexity_factors": {
            "us_market": 1.0,
            "hk_market": 1.2,
            "cn_market": 1.5,
            "crypto": 1.8,
        }
    },
    "system_monitoring": {
        "cpu_threshold": 80,     # CPU ä½¿ç”¨ç‡è¶…è¿‡ 80% æ—¶ç¼©å‡ agent
        "memory_threshold": 85,  # å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 85% æ—¶ç¼©å‡ agent
    }
}

if __name__ == "__main__":
    init_cache()
    print("âœ… é…ç½®å·²åŠ è½½")
    print(f"ğŸ“Š ç›‘æ§æ ‡çš„æ•°: {len(WATCHLIST)}")
    print(f"ğŸ“… å‚¬åŒ–å‰‚æ•°: {sum(len(v) for v in CATALYSTS.values())}")
    print(f"ğŸ”” å‘Šè­¦ç³»ç»Ÿ: {'å¯ç”¨' if ALERT_CONFIG.get('slack_enabled') or ALERT_CONFIG.get('email_enabled') else 'æœªå¯ç”¨'}")
    print(f"ğŸ“Š æŒ‡æ ‡æ”¶é›†: {'å¯ç”¨' if METRICS_CONFIG.get('enabled') else 'ç¦ç”¨'}")
    print(f"ğŸ’¾ ä¿¡æ¯ç´ æ¿: {'å¯ç”¨' if PHEROMONE_CONFIG.get('enabled') else 'ç¦ç”¨'}")
